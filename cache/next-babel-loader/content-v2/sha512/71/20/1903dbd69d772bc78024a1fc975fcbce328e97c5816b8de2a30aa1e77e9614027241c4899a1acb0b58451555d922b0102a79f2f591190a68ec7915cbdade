{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"C:/Users/\\u0420\\u0443\\u0441\\u043B\\u0430\\u043D/Desktop/NestAndNextShopPizza/frontend/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/\\u0420\\u0443\\u0441\\u043B\\u0430\\u043D/Desktop/NestAndNextShopPizza/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:/Users/\\u0420\\u0443\\u0441\\u043B\\u0430\\u043D/Desktop/NestAndNextShopPizza/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"C:/Users/\\u0420\\u0443\\u0441\\u043B\\u0430\\u043D/Desktop/NestAndNextShopPizza/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { Button, Checkbox, FormControlLabel, Grid, TextField, Typography } from '@material-ui/core';\nimport style from '../../style/auth.module.scss';\nimport getConfig from 'next/config';\nimport { useSnackbar } from 'notistack';\nimport { useAction } from '../../hooks/useAction';\nimport GoogleLogin from \"react-google-login\";\n\nvar _getConfig = getConfig(),\n    publicRuntimeConfig = _getConfig.publicRuntimeConfig;\n\nvar LoginPage = function LoginPage(_ref) {\n  var goRegister = _ref.goRegister,\n      handleClose = _ref.handleClose;\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      remMe = _React$useState2[0],\n      setRemMe = _React$useState2[1];\n\n  var _useAction = useAction(),\n      LoginLocal = _useAction.LoginLocal,\n      LoginGoogle = _useAction.LoginGoogle,\n      setUserLocal = _useAction.setUserLocal;\n\n  var _useSnackbar = useSnackbar(),\n      enqueueSnackbar = _useSnackbar.enqueueSnackbar;\n\n  var _React$useState3 = React.useState({\n    email: \"\",\n    password: \"\"\n  }),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      loginForm = _React$useState4[0],\n      setLoginForm = _React$useState4[1];\n\n  var changeForm = function changeForm(e) {\n    setLoginForm(_objectSpread(_objectSpread({}, loginForm), {}, _defineProperty({}, e.target.name, e.target.value)));\n  };\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var response, data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(publicRuntimeConfig.backendUri + \"/auth\", {\n                method: \"POST\",\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(_objectSpread({}, loginForm))\n              });\n\n            case 2:\n              response = _context.sent;\n\n              if (!(response.status !== 201)) {\n                _context.next = 7;\n                break;\n              }\n\n              enqueueSnackbar(\"invalid password or email\", {\n                variant: \"error\"\n              });\n              _context.next = 14;\n              break;\n\n            case 7:\n              _context.next = 9;\n              return response.json();\n\n            case 9:\n              data = _context.sent;\n              LoginLocal(data.access_token);\n              handleClose();\n              if (remMe) localStorage.setItem('token', data.access_token);\n              setUser(data.access_token);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function login() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var setUser = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(token) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch(publicRuntimeConfig.backendUri + \"/auth\", {\n                method: \"GET\",\n                headers: {\n                  'Authorization': 'Bearer ' + token\n                }\n              });\n\n            case 2:\n              response = _context2.sent;\n              _context2.t0 = setUserLocal;\n              _context2.next = 6;\n              return response.json();\n\n            case 6:\n              _context2.t1 = _context2.sent;\n              (0, _context2.t0)(_context2.t1);\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function setUser(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var responseSuccessGoogle = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(resolve) {\n      var _resolve$profileObj, email, name, googleId, imageUrl, response;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _resolve$profileObj = resolve.profileObj, email = _resolve$profileObj.email, name = _resolve$profileObj.name, googleId = _resolve$profileObj.googleId, imageUrl = _resolve$profileObj.imageUrl;\n              _context3.next = 3;\n              return fetch(publicRuntimeConfig.backendUri + '/users/google', {\n                method: \"POST\",\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                  email: email,\n                  googleId: googleId,\n                  nicname: name,\n                  icon: imageUrl\n                })\n              });\n\n            case 3:\n              response = _context3.sent;\n              _context3.t0 = LoginGoogle;\n              _context3.next = 7;\n              return response.json();\n\n            case 7:\n              _context3.t1 = _context3.sent;\n              (0, _context3.t0)(_context3.t1);\n              handleClose();\n\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function responseSuccessGoogle(_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var responseErrorGoogle = function responseErrorGoogle() {\n    enqueueSnackbar(\"не удалось войти в гугл\", {\n      variant: \"error\"\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(Typography, {\n      variant: \"h6\",\n      children: \"\\u0412\\u0445\\u043E\\u0434 \\u043D\\u0430 FamulyPizza\"\n    }), /*#__PURE__*/_jsx(TextField, {\n      value: loginForm.email,\n      onChange: changeForm,\n      size: \"small\",\n      variant: \"outlined\",\n      margin: \"normal\",\n      required: true,\n      fullWidth: true,\n      id: \"email\",\n      label: \"\\u041F\\u043E\\u0447\\u0442\\u0430\",\n      name: \"email\",\n      autoComplete: \"email\"\n    }), /*#__PURE__*/_jsx(TextField, {\n      value: loginForm.password,\n      onChange: changeForm,\n      size: \"small\",\n      variant: \"outlined\",\n      margin: \"normal\",\n      required: true,\n      fullWidth: true,\n      name: \"password\",\n      label: \"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\",\n      type: \"password\",\n      id: \"password\",\n      autoComplete: \"current-password\"\n    }), /*#__PURE__*/_jsx(FormControlLabel, {\n      value: remMe,\n      onChange: setRemMe.bind(null, function (prev) {\n        return !prev;\n      }),\n      control: /*#__PURE__*/_jsx(Checkbox, {\n        value: \"remember\",\n        color: \"primary\"\n      }),\n      label: \"\\u0417\\u0430\\u043F\\u043E\\u043C\\u043D\\u0438\\u0442\\u044C \\u043C\\u0435\\u043D\\u044F\"\n    }), /*#__PURE__*/_jsx(Button, {\n      onClick: login,\n      type: \"submit\",\n      fullWidth: true,\n      variant: \"contained\",\n      color: \"primary\",\n      children: \"\\u0412\\u043E\\u0439\\u0442\\u0438\"\n    }), /*#__PURE__*/_jsxs(Grid, {\n      container: true,\n      className: style.modalFooter,\n      children: [/*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: true\n      }), /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        children: /*#__PURE__*/_jsx(Typography, {\n          className: style.customLink,\n          variant: \"inherit\",\n          onClick: goRegister,\n          children: \"\\u0423 \\u0432\\u0430\\u0441 \\u043D\\u0435\\u0442 \\u0443\\u0447\\u0435\\u0442\\u043D\\u043E\\u0439 \\u0437\\u0430\\u043F\\u0438\\u0441\\u0438? \\u0417\\u0430\\u0440\\u0435\\u0433\\u0435\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F\"\n        })\n      })]\n    }), /*#__PURE__*/_jsx(GoogleLogin, {\n      className: style.auth__google,\n      clientId: \"1039089113540-k5pkcpnsa4eq6446risiup8sh6cn418g.apps.googleusercontent.com\",\n      buttonText: \"\\u0412\\u043E\\u0439\\u0442\\u0438 \\u0447\\u0435\\u0440\\u0435\\u0437 google\",\n      onSuccess: responseSuccessGoogle,\n      onFailure: responseErrorGoogle,\n      cookiePolicy: 'single_host_origin'\n    })]\n  });\n};\n\nexport default LoginPage;","map":null,"metadata":{},"sourceType":"module"}